<!-- templates/gestor/_avaliacoes-questoes.html -->
<div th:fragment="content">

    <h2 class="h5 mb-3">
        Avaliação • Questões
    </h2>

    <!-- Cabeçalho da avaliação -->
    <div class="mb-3">
        <h3 class="h6 mb-1" th:text="${avaliacao.titulo}">Título da avaliação</h3>
        <div class="text-muted small">
            <span th:text="${avaliacao.dataInicioAplic != null and avaliacao.dataFimAplic != null
                            ? #temporals.format(avaliacao.dataInicioAplic, 'dd/MM/yyyy')
                              + ' - ' +
                              #temporals.format(avaliacao.dataFimAplic, 'dd/MM/yyyy')
                            : '—'}">
                01/01/2025 - 31/01/2025
            </span>

            &nbsp;•&nbsp;

            <span th:text="${'Status: ' + avaliacao.status}">
                Status: RASCUNHO
            </span>
        </div>
    </div>

    <div class="row g-3">
        <!-- Coluna esquerda: Questões da avaliação -->
        <div class="col-lg-7">
            <h4 class="h6 mb-2">Questões da avaliação</h4>

            <div class="table-responsive">
                <table class="table align-middle table-sm">
                    <thead>
                    <tr>
                        <th style="width: 50px;">Ordem</th>
                        <th>Enunciado</th>
                        <th class="text-center" style="width: 140px;">Ações</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${questoesAvaliacao.isEmpty()}">
                        <td colspan="3" class="text-muted text-center">
                            Nenhuma questão adicionada ainda.
                        </td>
                    </tr>

                    <tr th:each="qa : ${questoesAvaliacao}">
                        <td th:text="${qa.ordem}">1</td>
                        <td th:text="${qa.enunciado}">Texto da questão</td>
                        <td class="text-center">

                            <!-- Formulário de mover para cima -->
                            <form th:action="@{'/app/avaliacoes/' + ${avaliacao.idAvaliacao} + '/questoes/subir'}"
                                  method="post"
                                  class="d-inline">

                                <!-- CSRF opcional -->
                                <th:block th:if="${_csrf != null}">
                                    <input type="hidden"
                                           th:name="${_csrf.parameterName}"
                                           th:value="${_csrf.token}"/>
                                </th:block>

                                <input type="hidden" name="idQuestao"
                                       th:value="${qa.idQuestao}"/>

                                <button type="submit"
                                        class="btn btn-sm btn-outline-secondary"
                                        title="Mover para cima">
                                    ↑
                                </button>
                            </form>

                            <!-- Formulário de mover para baixo -->
                            <form th:action="@{'/app/avaliacoes/' + ${avaliacao.idAvaliacao} + '/questoes/descer'}"
                                  method="post"
                                  class="d-inline">

                                <!-- CSRF opcional -->
                                <th:block th:if="${_csrf != null}">
                                    <input type="hidden"
                                           th:name="${_csrf.parameterName}"
                                           th:value="${_csrf.token}"/>
                                </th:block>

                                <input type="hidden" name="idQuestao"
                                       th:value="${qa.idQuestao}"/>

                                <button type="submit"
                                        class="btn btn-sm btn-outline-secondary"
                                        title="Mover para baixo">
                                    ↓
                                </button>
                            </form>

                            <!-- Formulário de remover da avaliação -->
                            <form th:action="@{'/app/avaliacoes/' + ${avaliacao.idAvaliacao} + '/questoes/remover'}"
                                  method="post"
                                  class="d-inline">

                                <!-- CSRF opcional -->
                                <th:block th:if="${_csrf != null}">
                                    <input type="hidden"
                                           th:name="${_csrf.parameterName}"
                                           th:value="${_csrf.token}"/>
                                </th:block>

                                <input type="hidden" name="idQuestao"
                                       th:value="${qa.idQuestao}"/>

                                <button type="submit"
                                        class="btn btn-sm btn-outline-danger"
                                        title="Remover da avaliação">
                                    Remover
                                </button>
                            </form>

                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Coluna direita: Catálogo de questões -->
        <div class="col-lg-5">
            <h4 class="h6 mb-2">Catálogo de questões</h4>

            <!-- Filtro simples por enunciado -->
            <form class="input-group input-group-sm mb-2" method="get"
                  th:action="@{'/app/avaliacoes/' + ${avaliacao.idAvaliacao} + '/questoes'}">
                <input type="text"
                       class="form-control"
                       name="termoCatalogo"
                       placeholder="Buscar no catálogo..."
                       th:value="${termoCatalogo}"/>
                <button class="btn btn-outline-secondary" type="submit">Filtrar</button>
                <a class="btn btn-outline-secondary"
                   th:href="@{'/app/avaliacoes/' + ${avaliacao.idAvaliacao} + '/questoes'}">Limpar</a>
            </form>

            <div class="table-responsive" style="max-height: 420px; overflow-y: auto;">
                <table class="table table-sm align-middle">
                    <thead>
                    <tr>
                        <th>Enunciado</th>
                        <th class="text-center" style="width: 90px;">Ação</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:if="${questoesCatalogo.isEmpty()}">
                        <td colspan="2" class="text-muted text-center">
                            Nenhuma questão encontrada no catálogo.
                        </td>
                    </tr>

                    <tr th:each="q : ${questoesCatalogo}">
                        <td th:text="${q.enunciado}">Questão do catálogo</td>
                        <td class="text-center">

                            <!-- Formulário para adicionar questão à avaliação -->
                            <form th:action="@{'/app/avaliacoes/' + ${avaliacao.idAvaliacao} + '/questoes/add'}"
                                  method="post">

                                <!-- CSRF opcional -->
                                <th:block th:if="${_csrf != null}">
                                    <input type="hidden"
                                           th:name="${_csrf.parameterName}"
                                           th:value="${_csrf.token}"/>
                                </th:block>

                                <input type="hidden" name="idQuestao"
                                       th:value="${q.idQuestao}"/>

                                <button type="submit"
                                        class="btn btn-sm btn-outline-primary">
                                    Adicionar
                                </button>
                            </form>

                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    <div class="mt-3">
        <a class="btn btn-outline-secondary"
           th:href="@{/app/avaliacoes}">
            Voltar para lista
        </a>
    </div>

</div>
