<div th:fragment="content">

    <h2 class="h5 mb-3" th:text="${isEdit} ? 'Editar Médico' : 'Novo Médico'">Médico</h2>

    <!-- Mensagens de feedback -->
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}"   class="alert alert-danger"  th:text="${error}"></div>

    <form th:action="${isEdit} ? @{|/app/admin/medicos/${id}|} : @{/app/admin/medicos}"
          method="post"
          class="vstack gap-3">

        <!-- BLOCO: NOVO MÉDICO -->
        <div th:if="${!isEdit}">
            <!-- Usuário -->
            <div class="mb-3">
                <label class="form-label">Usuário</label>
                <select class="form-select" name="usuarioId" required>
                    <option value="">Selecione o usuário...</option>
                    <option th:each="u : ${usuariosElegiveis}"
                            th:value="${u.idUsuario}"
                            th:text="${u.nome}">
                    </option>
                </select>
            </div>

            <!-- CRM -->
            <div>
                <label class="form-label">CRM</label>
                <div class="row g-2">
                    <div class="col-md-8">
                        <input class="form-control"
                               name="crmNumero"
                               placeholder="12345"
                               required>
                    </div>
                    <div class="col-md-4">
                        <input class="form-control"
                               name="crmUf"
                               placeholder="PR"
                               maxlength="2"
                               required
                               value="PR">
                    </div>
                </div>
            </div>

            <!-- Especialidade -->
            <div>
                <label class="form-label">Especialidade</label>
                <select class="form-select" name="especialidadeId" required>
                    <option value="">Selecione…</option>
                    <option th:each="e : ${especialidades}"
                            th:value="${e.idEspecialidade}"
                            th:text="${e.nome}">
                    </option>
                </select>
            </div>

            <!-- Unidade -->
            <div>
                <label class="form-label">Unidade</label>
                <select class="form-select" name="unidadeId" required>
                    <option value="">Selecione…</option>
                    <option th:each="u : ${unidades}"
                            th:value="${u.idUnidade}"
                            th:text="${u.nome}">
                    </option>
                </select>
            </div>
        </div>

        <!-- BLOCO: EDITAR MÉDICO -->
        <div th:if="${isEdit}">
            <!-- Usuário (somente leitura) -->
            <div class="mb-3">
                <label class="form-label">Usuário</label>
                <input class="form-control" type="text" th:value="${usuarioNome}" disabled>
            </div>

            <!-- CRM -->
            <div>
                <label class="form-label">CRM</label>
                <div class="row g-2">
                    <div class="col-md-8">
                        <input class="form-control"
                               name="crmNumero"
                               placeholder="12345"
                               required
                               th:value="${medico.crmNumero}">
                    </div>
                    <div class="col-md-4">
                        <input class="form-control"
                               name="crmUf"
                               placeholder="PR"
                               maxlength="2"
                               required
                               th:value="${medico.crmUf}">
                    </div>
                </div>
            </div>

            <!-- Especialidade -->
            <div>
                <label class="form-label">Especialidade</label>
                <select class="form-select" name="especialidadeId" required>
                    <option value="">Selecione…</option>
                    <option th:each="e : ${especialidades}"
                            th:value="${e.idEspecialidade}"
                            th:text="${e.nome}"
                            th:selected="${medico.especialidadeId} == ${e.idEspecialidade}">
                    </option>
                </select>
            </div>

            <!-- Unidade -->
            <div>
                <label class="form-label">Unidade</label>
                <select class="form-select" name="unidadeId" required>
                    <option value="">Selecione…</option>
                    <option th:each="u : ${unidades}"
                            th:value="${u.idUnidade}"
                            th:text="${u.nome}"
                            th:selected="${medico.unidadeId} == ${u.idUnidade}">
                    </option>
                </select>
            </div>
        </div>

        <!-- Botões -->
        <div class="d-flex gap-2 mt-3">
            <button class="btn btn-primary" type="submit">Salvar</button>
            <a class="btn btn-outline-secondary" th:href="@{/app/admin/medicos}">Cancelar</a>
        </div>

        <!-- Hint de método -->
        <input type="hidden" name="_method" th:value="${isEdit} ? 'put' : 'post'"/>
    </form>
</div>
